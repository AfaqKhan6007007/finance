<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if is_edit %}Edit{% else %}New{% endif %} Account - Finance</title>
    <style>
        * {
            margin: 0;
            padding:  0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f9fafb;
            color: #333;
        }

        body.sidebar-collapsed .sidebar {
            transform: translateX(-100%);
        }

        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s ease, width 0.3s ease;
        }

        body.sidebar-collapsed .header {
            margin-left: 0;
            width: 100%;
        }

        body.sidebar-collapsed .main-content {
            margin-left: 0;
        }
        
        /* Breadcrumb */
        .breadcrumb {
            padding: 16px 40px;
            
            
            font-size: 14px;
            color: #666;
        }
        
        .breadcrumb a {
            color: #666;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            color: #00b894;
        }
        
        .breadcrumb-separator {
            margin: 0 8px;
            color: #999;
        }
        
        /* Header */
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            
            
        }
        
        .form-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .menu-icon {
            font-size: 24px;
            color: #00b894;
            cursor: pointer;
        }
        
        .form-title h1 {
            font-size: 24px;
            font-weight: 600;
            color: #00b894;
        }
        
        .btn-save {
            padding: 10px 32px;
            background-color:  #00b894;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-save:hover {
            background-color: #00a281;
        }
        
        /* Form Container */
        .form-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 40px;
        }
        
        .form-card {
            background:  white;
            border-radius:  8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 40px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px 32px;
        }
        
        /* Form Fields */
        .form-group {
            margin-bottom:  0;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-label {
            display: block;
            font-size: 13px;
            font-weight:  600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .form-label.required::after {
            content: " *";
            color: #dc2626;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
            color: #333;
            background-color: white;
            transition: border-color 0.2s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #00b894;
            box-shadow: 0 0 0 3px rgba(0, 184, 148, 0.1);
        }
        
        .form-control::placeholder {
            color: #9ca3af;
        }
        
        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
        }
        
        .form-help {
            font-size: 12px;
            color: #6b7280;
            margin-top: 6px;
            font-style: italic;
        }
        
        /* Checkbox */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
        }
        
        .checkbox-input {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #00b894;
        }
        
        .checkbox-label {
            font-size: 13px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
        }
        
        /* Messages */
        .messages {
            margin-bottom: 24px;
        }
        
        .alert {
            padding: 12px 16px;
            border-radius:  6px;
            margin-bottom:  12px;
            font-size: 14px;
        }
        
        .alert-success {
            background-color:  #d1fae5;
            color:  #059669;
            border-left: 4px solid #059669;
        }
        
        .alert-error {
            background-color: #fee2e2;
            color:  #dc2626;
            border-left: 4px solid #dc2626;
        }
        
        .error-message {
            color: #dc2626;
            font-size: 12px;
            margin-top:  4px;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-container {
                padding: 20px;
            }
            
            .form-card {
                padding: 24px;
            }
        }
    </style>
</head>
<body>
    {% include "finance/header.html" %}
    {% include "finance/sidenav.html" %}
    <div class="main-content">
    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <a href="{% url 'finance-accounts' %}">Account</a>
        <span class="breadcrumb-separator">›</span>
        <span>{% if is_edit %}Edit{% else %}New{% endif %} Account</span>
    </div>
    
    <!-- Header -->
    <div class="form-header">
        <div class="form-title">
            <span class="menu-icon">☰</span>
            <h1>{% if is_edit %}Edit{% else %}New{% endif %} Account</h1>
        </div>
        <button type="submit" form="account-form" class="btn-save">Save</button>
    </div>
    
    <!-- Form Container -->
    <div class="form-container">
        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- ADD THIS SECTION TO SEE ERRORS -->
    {% if form.errors %}
    <div class="alert alert-error">
        <strong>Form Errors Found:</strong>
        <ul style="margin-top: 8px; margin-left: 20px; list-style: disc;">
            {% for field in form %}
                {% if field.errors %}
                    <li><strong>{{ field.label }}:</strong> {{ field.errors.0 }}</li>
                {% endif %}
            {% endfor %}
            {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #fca5a5;">
            <strong>Form Data Debug:</strong>
            <ul style="margin-top: 4px; margin-left: 20px; font-size: 12px;">
                <li>Company value: {{ form.company.value }}</li>
                <li>Company data: {{ form.data.company }}</li>
                <li>Name value: {{ form.name.value }}</li>
            </ul>
        </div>
    </div>
    {% endif %}
        
        <div class="form-card">
            <form method="post" id="account-form">
                {% csrf_token %}
                
                <div class="form-grid">
                    <!-- Disable Checkbox -->
                    <div class="checkbox-group">
                        {{ form.is_disabled }}
                        <label for="id_is_disabled" class="checkbox-label">Disable</label>
                    </div>
                    
                    <!-- Empty cell to maintain grid -->
                    <div></div>
                    
                    <!-- Account Name -->
                    <div class="form-group">
                        <label for="id_name" class="form-label required">Account Name</label>
                        <input type="text" name="name" id="id_name" class="form-control" 
                               placeholder="Enter account name" 
                               value="{{ form.name.value|default:'' }}" required>
                        {% if form.name.errors %}
                            <div class="error-message">{{ form.name.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <!-- Parent Account -->
                    <div class="form-group">
                        <label for="id_parent_account" class="form-label">Parent Account</label>
                        <select name="parent_account" id="id_parent_account" class="form-control">
                            <option value="">None (Top Level Account)</option>
                            {% for account in form.fields.parent_account.queryset %}
                            <option value="{{ account.pk }}" 
                                    data-company="{{ account.company.pk }}"
                                    {% if form.parent_account.value == account.pk|stringformat:"s" %}selected{% endif %}>
                                {{ account.name }}{% if account.account_number %} - {{ account.account_number }}{% endif %}
                            </option>
                            {% endfor %}
                        </select>
                        <p class="form-help">Parent accounts will be filtered based on the selected company.  Save to refresh options if you change the company.</p>
                        {% if form.parent_account.errors %}
                            <div class="error-message">{{ form.parent_account.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <!-- Account Number -->
                    <div class="form-group">
                        <label for="id_account_number" class="form-label">Account Number</label>
                        <input type="text" name="account_number" id="id_account_number" class="form-control" 
                               placeholder="Enter account number" 
                               value="{{ form.account_number.value|default:'' }}">
                        {% if form.account_number.errors %}
                            <div class="error-message">{{ form.account_number.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <!-- Account Type -->
                    <div class="form-group">
                        <label for="id_account_type" class="form-label">Account Type</label>
                        <select name="account_type" id="id_account_type" class="form-control">
                            <option value=""></option>
                            {% for value, label in form.fields.account_type.choices %}
                                {% if value %}
                                <option value="{{ value }}" 
                                        {% if form.account_type.value == value %}selected{% endif %}>
                                    {{ label }}
                                </option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        <p class="form-help">Setting account type helps in selecting this account in transactions.</p>
                        {% if form.account_type.errors %}
                            <div class="error-message">{{ form.account_type.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <!-- Is Group Checkbox -->
                    <div class="checkbox-group">
                        {{ form.is_group }}
                        <label for="id_is_group" class="checkbox-label">Is Group</label>
                    </div>
                    
                    <!-- Tax Rate -->
                    <div class="form-group">
                        <label for="id_tax_rate" class="form-label">Tax Rate</label>
                        <input type="number" step="0.01" name="tax_rate" id="id_tax_rate" class="form-control" 
                               placeholder="Tax Value" 
                               value="{{ form.tax_rate.value|default:'0.00' }}">
                        {% if form.tax_rate.errors %}
                            <div class="error-message">{{ form.tax_rate.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <!-- Company -->
                    <div class="form-group">
                        <label for="id_company" class="form-label required">Company</label>
                        <select name="company" id="id_company" class="form-control" required>
                            <option value="">Select company</option>
                            {% for company in form.fields.company.queryset %}
                            <option value="{{ company.pk }}" 
                                    {% if form.company.value == company.pk or form.data.company|add:"0" == company.pk %}selected{% endif %}>
                                {{ company.name }}
                            </option>
                            {% endfor %}
                        </select>
                        {% if form.company.errors %}
                            <div class="error-message">{{ form.company.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <!-- Balance Must Be -->
                    <div class="form-group">
                        <label for="id_balance_must_be" class="form-label">Balance Must Be</label>
                        <select name="balance_must_be" id="id_balance_must_be" class="form-control">
                            <option value=""></option>
                            {% for value, label in form.fields.balance_must_be.choices %}
                                {% if value %}
                                <option value="{{ value }}" 
                                        {% if form.balance_must_be.value == value %}selected{% endif %}>
                                    {{ label }}
                                </option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        {% if form.balance_must_be.errors %}
                            <div class="error-message">{{ form.balance_must_be.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <!-- Currency -->
                    <div class="form-group">
                        <label for="id_currency" class="form-label">Currency</label>
                        <select name="currency" id="id_currency" class="form-control">
                            <option value="USD" {% if form.currency.value == "USD" or not form.currency.value %}selected{% endif %}>USD</option>
                            <option value="SAR" {% if form.currency.value == "SAR" %}selected{% endif %}>SAR</option>
                            <option value="PKR" {% if form.currency.value == "PKR" %}selected{% endif %}>PKR</option>
                            <option value="EUR" {% if form.currency.value == "EUR" %}selected{% endif %}>EUR</option>
                            <option value="GBP" {% if form.currency.value == "GBP" %}selected{% endif %}>GBP</option>
                            <option value="AED" {% if form.currency.value == "AED" %}selected{% endif %}>AED</option>
                        </select>
                        {% if form.currency.errors %}
                            <div class="error-message">{{ form.currency.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <!-- Empty cell -->
                    <div></div>
                </div>
            </form>
        </div>
    </div>
    </div>
    
    <script>
    // Add checkbox styling
    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.classList.add('checkbox-input');
    });
    
    // Auto-hide messages after 5 seconds
    setTimeout(() => {
        const messages = document.querySelector('.messages');
        if (messages) {
            messages.style.transition = 'opacity 0.5s';
            messages.style.opacity = '0';
            setTimeout(() => messages.remove(), 500);
        }
    }, 5000);
    
    // Show warning when company changes
    const companySelect = document.getElementById('id_company');
    const parentAccountSelect = document.getElementById('id_parent_account');
    
    if (companySelect) {
        companySelect.addEventListener('change', function() {
            if (parentAccountSelect.value) {
                alert('Please note:  Changing the company will require you to reselect the parent account.  Save the form to see updated parent accounts for the new company.');
            }
        });
    }
</script>
</body>
</html>