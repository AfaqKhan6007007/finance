<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Financial Reports - Finance</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f9fafb; color: #333; }
        body.sidebar-collapsed .sidebar { transform: translateX(-100%); }
        body.sidebar-collapsed .header { top:0; margin-left: 0; width: 100%; }
        body.sidebar-collapsed .container { margin-left: 0; }
        .container { max-width: 1400px; margin: 0 auto; padding: 32px 24px; margin-left: var(--sidebar-width); transition: margin-left 0.3s ease, width 0.3s ease; z-index: 1; }
        .header-2 { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; }
        .header-left h1 { font-size: 28px; font-weight: 600; margin-bottom: 5px; }
        .header-left p { color: #666; font-size: 14px; }
        .header-right { display: flex; gap: 10px; }
        .btn { padding: 10px 20px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 8px; }
        .btn-excel { background-color: white; color: #333; }
        .btn-pdf { background-color: #059669; color: white; border: none; }
        .tabs { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 30px; justify-content: space-evenly; }
        .tab { padding: 15px 30px; cursor: pointer; font-size: 15px; font-weight: 500; color: #666; border: none; background: none; border-bottom: 3px solid transparent; transition: all 0.3s; width: 33%; }
        .tab:hover { color: #059669; }
        .tab.active { color: #059669; border-bottom-color: #059669; background-color: #ecfdf5; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .section-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        .card { border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .revenue-card { background-color: #ecfdf5; border: 1px solid #d1fae5; }
        .expenses-card { background-color: #fef2f2; border: 1px solid #fecaca; }
        .net-profit-card { background-color: #d1fae5; border: 1px solid #a7f3d0; }
        .card-header { font-weight: 600; font-size: 16px; margin-bottom: 15px; color: #333; }
        .line-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(0, 0, 0, 0.05); }
        .line-item:last-child { border-bottom: none; }
        .line-item-label { color: #059669; }
        .expenses-card .line-item-label { color: #dc2626; }
        .line-item-value { font-weight: 500; }
        .total-line { font-weight: 700; padding-top: 15px; margin-top: 10px; border-top: 2px solid rgba(0,0,0,0.1); }
        .net-profit-card .profit-display { display: flex; justify-content: space-between; align-items: center; font-size: 18px; font-weight: 700; }
        .balance-sheet-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 20px; }
        .assets-section, .liabilities-section { background-color: #f9fafb; padding: 25px; border-radius: 8px; }
        .section-heading { font-size: 22px; font-weight: 600; margin-bottom: 20px; }
        .asset-card { background-color: #eff6ff; border: 1px solid #dbeafe; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .liability-card { background-color: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .equity-card { background-color: #f5f3ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .subsection-title { font-weight: 600; font-size: 15px; margin-bottom: 12px; color: #1e40af; }
        .liability-card .subsection-title { color: #dc2626; }
        .equity-card .subsection-title { color: #7c3aed; }
        .asset-line, .liability-line { display: flex; justify-content: space-between; padding: 8px 0; font-size: 14px; }
        .asset-line-label { color: #1e40af; }
        
        .liability-line-label { color: #dc2626; }
        .equity-line-label { color: #7c3aed; }
        .total-card { background-color: #dbeafe; border: 2px solid #93c5fd; border-radius: 8px; padding: 20px; margin-top: 15px; }
        .liability-total-card { background-color: #f3f4f6; border: 2px solid #d1d5db; }
        .total-display { display: flex; justify-content: space-between; font-size: 18px; font-weight: 700; }
        .chart-container { background-color: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 30px; margin-bottom: 30px; }
        .chart-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        .chart-placeholder { width: 100%; height: 400px; background: linear-gradient(180deg, #f9fafb 0%, #ffffff 100%); border: 1px solid #e5e7eb; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #9ca3af; font-size: 14px; margin-bottom: 20px; position: relative; overflow: hidden; }
        .chart-svg { width: 100%; height: 100%; }
        .legend { display: flex; justify-content: center; gap: 30px; margin-top: 15px; }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 13px; }
        .legend-color { width: 30px; height: 3px; border-radius: 2px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .metric-card { border-radius: 8px; padding: 20px; border: 1px solid; }
        .metric-card.operating { background-color: #ecfdf5; border-color: #a7f3d0; }
        .metric-card.investing { background-color: #eff6ff; border-color: #bfdbfe; }
        .metric-card.financing { background-color: #fef3c7; border-color: #fcd34d; }
        .metric-label { font-size: 14px; font-weight: 500; margin-bottom: 10px; }
        .metric-card.operating .metric-label { color: #059669; }
        .metric-card.investing .metric-label { color: #2563eb; }
        .metric-card.financing .metric-label { color: #d97706; }
        .metric-value { font-size: 28px; font-weight: 700; }
        .metric-card.operating .metric-value { color: #047857; }
        .metric-card.investing .metric-value { color: #1e40af; }
        .metric-card.financing .metric-value { color: #b45309; }
        .journal-section { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); }
        table.recent { width: 100%; border-collapse: collapse; margin-top: 16px; }
        table.recent th, table.recent td { padding: 8px 10px; border-bottom: 1px solid #e5e7eb; text-align: left; font-size: 13px; }
    </style>
</head>
<body>

    {% include "finance/header.html" %}
    {% include "finance/sidenav.html" %}

    <div class="container">
        <div class="header-2">
            <div class="header-left">
                <h1>Financial Reports</h1>
                <p>Comprehensive financial statements and analysis</p>
            </div>
            <div class="header-right">
                <button class="btn btn-excel">
                    <span>ðŸ“„</span> Export Excel
                </button>
                <button class="btn btn-pdf">
                    <span>â¬‡</span> Download PDF
                </button>
            </div>
        </div>

        <div class="journal-section">
            <div class="tabs">
                <button class="tab active" onclick="showTab('profit-loss', event)">Profit & Loss</button>
                <button class="tab" onclick="showTab('balance-sheet', event)">Balance Sheet</button>
                <button class="tab" onclick="showTab('cash-flow', event)">Cash Flow</button>
            </div>

            <!-- Profit & Loss Tab -->
            <div id="profit-loss" class="tab-content active">
                <div class="section-title">Income Statement</div>

                <div class="card revenue-card">
                    <div class="card-header">Revenue</div>

                    {% if revenue_items %}
                        {% for item in revenue_items %}
                            <div class="line-item">
                                <span class="line-item-label">{{ item.label }}</span>
                                <span class="line-item-value">${{ item.amount|floatformat:2 }}</span>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="line-item">
                            <span class="line-item-label">Sales Revenue</span>
                            <span class="line-item-value">$0.00</span>
                        </div>
                    {% endif %}

                    <div class="line-item total-line">
                        <span class="line-item-label">Total Revenue</span>
                        <span class="line-item-value">${{ total_revenue|floatformat:2 }}</span>
                    </div>
                </div>

                <div class="card expenses-card">
                    <div class="card-header">Expenses</div>

                    {% if expense_items %}
                        {% for item in expense_items %}
                            <div class="line-item">
                                <span class="line-item-label">{{ item.label }}</span>
                                <span class="line-item-value">${{ item.amount|floatformat:2 }}</span>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="line-item">
                            <span class="line-item-label">Salaries Expense</span>
                            <span class="line-item-value">$0.00</span>
                        </div>
                    {% endif %}

                    <div class="line-item total-line">
                        <span class="line-item-label">Total Expenses</span>
                        <span class="line-item-value">${{ total_expenses|floatformat:2 }}</span>
                    </div>
                </div>

                <div class="card net-profit-card">
                    <div class="profit-display">
                        <span>Net Profit</span>
                        <span>${{ net_profit|floatformat:2 }}</span>
                    </div>
                </div>
            </div>

            <!-- Balance Sheet Tab -->
            <div id="balance-sheet" class="tab-content">
                <div class="balance-sheet-grid">
                    <div class="assets-section">
                        <div class="section-heading">Assets</div>

                        <div class="asset-card">
                            <div class="subsection-title">Current Assets</div>
                            {% for a in assets_list|slice:":4" %}
                                <div class="asset-line">
                                    <span class="asset-line-label">{{ a.name }}</span>
                                    {% if a.is_negative %}
                                        <span class="asset-balance negative">
                                            ${{ a.display_balance|floatformat:2 }}</span>
                                    {% else %}
                                        <span class="asset-balance">${{ a.display_balance|floatformat:2 }}</span>
                                    {% endif %}
                                </div>
                            {% empty %}
                                <div class="asset-line">
                                    <span class="asset-line-label">Cash</span>
                                    <span>$0.00</span>
                                </div>
                            {% endfor %}
                            <div class="asset-line total-line">
                                <span class="asset-line-label"><strong>Total Current Assets</strong></span>
                                <span><strong>${{ display_total_assets|floatformat:2 }}</strong></span>
                            </div>
                        </div>

                        <div class="asset-card">
                            <div class="subsection-title">Fixed Assets</div>
                            {% for a in assets_list|slice:"4:" %}
                                <div class="asset-line">
                                    <span class="asset-line-label">{{ a.name }}</span>
                                    <span>${{ a.balance|floatformat:2 }}</span>
                                </div>
                            {% endfor %}
                            {% if assets_list|length < 5 %}
                                <div class="asset-line">
                                    <span class="asset-line-label">Equipment</span>
                                    <span>$0.00</span>
                                </div>
                            {% endif %}
                            <div class="asset-line total-line">
                                <span class="asset-line-label"><strong>Total Fixed Assets</strong></span>
                                <span>${{ display_total_assets|floatformat:2 }}</span>
                            </div>
                        </div>

                        <div class="total-card">
                            <div class="total-display">
                                <span>Total Assets</span>
                                <span>${{ display_total_assets|floatformat:2 }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="liabilities-section">
                        <div class="section-heading">Liabilities & Equity</div>

                        <div class="liability-card">
                            <div class="subsection-title">Current Liabilities</div>
                            {% for l in liabilities_list|slice:":4" %}
                                <div class="liability-line">
                                    <span class="liability-line-label">{{ l.name }}</span>
                                    {% if l.is_negative %}
                                        <span class="liability-balance negative">${{ l.display_balance|floatformat:2 }}</span>
                                    {% else %}
                                        <span class="liability-balance">${{ l.display_balance|floatformat:2 }}</span>
                                    {% endif %}
                                </div>
                            {% empty %}
                                <div class="liability-line">
                                    <span class="liability-line-label">Accounts Payable</span>
                                    <span>$0.00</span>
                                </div>
                            {% endfor %}
                            <div class="liability-line total-line">
                                <span class="liability-line-label"><strong>Total Current Liabilities</strong></span>
                                <span><strong>${{ display_total_liabilities|floatformat:2 }}</strong></span>
                            </div>
                        </div>

                        <div class="liability-card">
                            <div class="subsection-title">Long-term Liabilities</div>
                            {% for l in liabilities_list|slice:"4:" %}
                                <div class="liability-line">
                                    <span class="liability-line-label">{{ l.name }}</span>
                                    <span>${{ l.balance|floatformat:2 }}</span>
                                </div>
                            {% endfor %}
                            <div class="liability-line total-line">
                                <span class="liability-line-label"><strong>Total Long-term Liabilities</strong></span>
                                <span><strong>${{ display_total_liabilities|floatformat:2 }}</strong></span>
                            </div>
                        </div>

                        <div class="equity-card">
                            <div class="subsection-title">Equity</div>
                            {% for q in equity_list %}
                                <div class="asset-line">
                                    <span class="equity-line-label">{{ q.name }}</span>
                                    <span>${{ q.balance|floatformat:2 }}</span>
                                </div>
                            {% empty %}
                                <div class="asset-line">
                                    <span class="equity-line-label">Owner's Equity</span>
                                    <span>$0.00</span>
                                </div>
                            {% endfor %}
                            <div class="asset-line total-line">
                                <span class="equity-line-label"><strong>Total Equity</strong></span>
                                <span><strong>${{ display_total_equity|floatformat:2 }}</strong></span>
                            </div>
                        </div>

                        <div class="total-card liability-total-card">
                            <div class="total-display">
                                <span>Total Liabilities & Equity</span>
                                <span>${{ display_total_liabilities_and_equity|floatformat:2 }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cash Flow Tab -->
            <div id="cash-flow" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">Cash Flow Statement</div>

                    <div class="chart-placeholder">
                        <svg class="chart-svg" viewBox="0 0 1200 400" preserveAspectRatio="xMidYMid meet">
                            <line x1="80" y1="50" x2="80" y2="350" stroke="#e5e7eb" stroke-width="2"/>
                            <line x1="80" y1="350" x2="1150" y2="350" stroke="#e5e7eb" stroke-width="2"/>

                            <line x1="80" y1="50" x2="1150" y2="50" stroke="#f3f4f6" stroke-width="1"/>
                            <line x1="80" y1="125" x2="1150" y2="125" stroke="#f3f4f6" stroke-width="1"/>
                            <line x1="80" y1="200" x2="1150" y2="200" stroke="#f3f4f6" stroke-width="1"/>
                            <line x1="80" y1="275" x2="1150" y2="275" stroke="#f3f4f6" stroke-width="1"/>

                            {% if cashflow_labels %}
                                {% for item in cashflow_labels %}
                                    <text x="{{ item.x }}" y="370" text-anchor="middle" font-size="12" fill="#6b7280">{{ item.label }}</text>
                                {% endfor %}
                            {% else %}
                                <text x="150" y="370" text-anchor="middle" font-size="12" fill="#6b7280">Apr</text>
                                <text x="370" y="370" text-anchor="middle" font-size="12" fill="#6b7280">May</text>
                                <text x="590" y="370" text-anchor="middle" font-size="12" fill="#6b7280">Jun</text>
                                <text x="810" y="370" text-anchor="middle" font-size="12" fill="#6b7280">Jul</text>
                                <text x="1030" y="370" text-anchor="middle" font-size="12" fill="#6b7280">Aug</text>
                                <text x="1150" y="370" text-anchor="middle" font-size="12" fill="#6b7280">Sep</text>
                            {% endif %}

                            {% if poly_financing %}
                                <polyline points="{{ poly_financing|safe }}" fill="none" stroke="#f59e0b" stroke-width="2.5"/>
                            {% endif %}
                            {% if poly_investing %}
                                <polyline points="{{ poly_investing|safe }}" fill="none" stroke="#3b82f6" stroke-width="2.5"/>
                            {% endif %}
                            {% if poly_operating %}
                                <polyline points="{{ poly_operating|safe }}" fill="none" stroke="#10b981" stroke-width="2.5"/>
                            {% endif %}
                        </svg>
                    </div>

                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f59e0b;"></div>
                            <span>Financing Activities</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #3b82f6;"></div>
                            <span>Investing Activities</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #10b981;"></div>
                            <span>Operating Activities</span>
                        </div>
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card operating">
                        <div class="metric-label">Operating Activities</div>
                        <div class="metric-value">${{ operating_metric|floatformat:2 }}</div>
                    </div>
                    <div class="metric-card investing">
                        <div class="metric-label">Investing Activities</div>
                        <div class="metric-value">${{ investing_metric|floatformat:2 }}</div>
                    </div>
                    <div class="metric-card financing">
                        <div class="metric-label">Financing Activities</div>
                        <div class="metric-value">${{ financing_metric|floatformat:2 }}</div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 28px;">
                <div class="section-title">Recent Journal Entries</div>
                <table class="recent" aria-label="Recent journal entries">
                    <thead>
                        <tr>
                            <th>Entry #</th>
                            <th>Date</th>
                            <th>Account</th>
                            <th>Description</th>
                            <th>Debit</th>
                            <th>Credit</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for je in recent_entries %}
                            <tr>
                                <td>{{ je.entry_number }}</td>
                                <td>{{ je.date }}</td>
                                <td>{{ je.account.name }}</td>
                                <td>{{ je.description|default:"-" }}</td>
                                <td>${{ je.debit_amount|floatformat:2 }}</td>
                                <td>${{ je.credit_amount|floatformat:2 }}</td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="6">No recent entries</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName, ev) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            const selected = document.getElementById(tabName);
            if (selected) selected.classList.add('active');
            if (ev && ev.currentTarget) ev.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>